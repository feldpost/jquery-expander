/*!
 * Expander - v1.4.7 - 2014-01-09
 * http://plugins.learningjquery.com/expander/
 * Copyright (c) 2014 Karl Swedberg
 * Licensed MIT (http://www.opensource.org/licenses/mit-license.php)
 */

(function(e){e.expander={version:"1.4.7",defaults:{slicePoint:100,preserveWords:!0,preserveSentences:!1,widow:4,expandText:"read more",expandPrefix:"&hellip; ",expandAfterSummary:!1,summaryClass:"summary",detailClass:"details",moreClass:"read-more",lessClass:"read-less",collapseTimer:0,expandEffect:"slideDown",expandSpeed:250,collapseEffect:"slideUp",collapseSpeed:200,userCollapse:!0,userCollapseText:"read less",userCollapsePrefix:" ",onSlice:null,beforeExpand:null,afterExpand:null,onCollapse:null,afterCollapse:null}},e.fn.expander=function(a){function l(e,a){var l="span",s=e.summary;return a?(l="div",h.test(s)&&!e.expandAfterSummary?s=s.replace(h,e.moreLabel+"$1"):s+=e.moreLabel,s='<div class="'+e.summaryClass+'">'+s+"</div>"):s+=e.moreLabel,[s," <",l+' class="'+e.detailClass+'"',">",e.details,"</"+l+">"].join("")}function s(e){var a='<span class="'+e.moreClass+'">'+e.expandPrefix;return a+='<a href="#">'+e.expandText+"</a></span>"}function n(a,l,s){return a.lastIndexOf("<")>a.lastIndexOf(">")&&(a=a.slice(0,a.lastIndexOf("<"))),s?a=a.replace(f,"."):l&&(a=a.replace(c,"")),e.trim(a)}function t(e,a){a.stop(!0,!0)[e.collapseEffect](e.collapseSpeed,function(){var l=a.prev("span."+e.moreClass).show();l.length||a.parent().children("div."+e.summaryClass).show().find("span."+e.moreClass).show(),e.afterCollapse&&e.afterCollapse.call(a)})}function r(a,l,s){a.collapseTimer&&(o=setTimeout(function(){t(a,l),e.isFunction(a.onCollapse)&&a.onCollapse.call(s,!1)},a.collapseTimer))}var i="init";"string"==typeof a&&(i=a,a={});var o,d=e.extend({},e.expander.defaults,a),p=/^<(?:area|br|col|embed|hr|img|input|link|meta|param).*>$/i,c=d.wordEnd||/(&(?:[^;]+;)?|[a-zA-Z\u00C0-\u0100]+)$/,f=d.sentenceEnd||/\.(?=[^.]*$).*$/,u=/<\/?(\w+)[^>]*>/g,m=/<(\w+)[^>]*>/g,x=/<\/(\w+)>/g,h=/(<\/[^>]+>)\s*$/,C=/^(<[^>]+>)+.?/,v={init:function(){this.each(function(){var a,i,c,f,h,v,S,g,E,b,y,w,T,$,I=[],P=[],j={},k=this,D=e(this),A=e([]),L=e.extend({},d,D.data("expander")||e.meta&&D.data()||{}),O=!!D.find("."+L.detailClass).length,z=!!D.find("*").filter(function(){var a=e(this).css("display");return/^block|table|list/.test(a)}).length,F=z?"div":"span",U=F+"."+L.detailClass,W=L.moreClass+"",Q=L.lessClass+"",Z=L.expandSpeed||0,q=e.trim(D.html()),B=(e.trim(D.text()),q.slice(0,L.slicePoint));if(L.moreSelector="span."+W.split(" ").join("."),L.lessSelector="span."+Q.split(" ").join("."),!e.data(this,"expanderInit")){for(e.data(this,"expanderInit",!0),e.data(this,"expander",L),e.each(["onSlice","beforeExpand","afterExpand","onCollapse","afterCollapse"],function(a,l){j[l]=e.isFunction(L[l])}),B=n(B),h=B.replace(u,"").length;L.slicePoint>h;)f=q.charAt(B.length),"<"===f&&(f=q.slice(B.length).match(C)[0]),B+=f,h++;for(B=n(B,L.preserveWords,L.preserveSentences),v=B.match(m)||[],S=B.match(x)||[],c=[],e.each(v,function(e,a){p.test(a)||c.push(a)}),v=c,i=S.length,a=0;i>a;a++)S[a]=S[a].replace(x,"$1");if(e.each(v,function(a,l){var s=l.replace(m,"$1"),n=e.inArray(s,S);-1===n?(I.push(l),P.push("</"+s+">")):S.splice(n,1)}),P.reverse(),O)E=D.find(U).remove().html(),B=D.html(),q=B+E,g="";else{if(E=q.slice(B.length),b=e.trim(E.replace(u,"")),""===b||b.split(/\s+/).length<L.widow)return;g=P.pop()||"",B+=P.join(""),E=I.join("")+E}L.moreLabel=D.find(L.moreSelector).length?"":s(L),z&&(E=q),B+=g,L.summary=B,L.details=E,L.lastCloseTag=g,j.onSlice&&(c=L.onSlice.call(k,L),L=c&&c.details?c:L),y=l(L,z),D.html(y),T=D.find(U),$=D.find(L.moreSelector),"slideUp"===L.collapseEffect&&"slideDown"!==L.expandEffect||D.is(":hidden")?T.css({display:"none"}):T[L.collapseEffect](0),A=D.find("div."+L.summaryClass),w=function(e){e.preventDefault(),$.hide(),A.hide(),j.beforeExpand&&L.beforeExpand.call(k),T.stop(!1,!0)[L.expandEffect](Z,function(){T.css({zoom:""}),j.afterExpand&&L.afterExpand.call(k),r(L,T,k)})},$.find("a").unbind("click.expander").bind("click.expander",w),L.userCollapse&&!D.find(L.lessSelector).length&&D.find(U).append('<span class="'+L.lessClass+'">'+L.userCollapsePrefix+'<a href="#">'+L.userCollapseText+"</a></span>"),D.find(L.lessSelector+" a").unbind("click.expander").bind("click.expander",function(a){a.preventDefault(),clearTimeout(o);var l=e(this).closest(U);t(L,l),j.onCollapse&&L.onCollapse.call(k,!0)})}})},destroy:function(){this.each(function(){var a,l,s=e(this);s.data("expanderInit")&&(a=e.extend({},s.data("expander")||{},d),l=s.find("."+a.detailClass).contents(),s.removeData("expanderInit"),s.removeData("expander"),s.find(a.moreSelector).remove(),s.find("."+a.summaryClass).remove(),s.find("."+a.detailClass).after(l).remove(),s.find(a.lessSelector).remove())})}};return v[i]&&v[i].call(this),this},e.fn.expander.defaults=e.expander.defaults})(jQuery);